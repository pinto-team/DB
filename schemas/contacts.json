{
  "$id": "https://yourdomain/schemas/contact.json",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Contact",
  "type": "object",
  "additionalProperties": false,

  "properties": {
    "id": { "type": "string", "format": "uuid", "readOnly": true },
    "owner_type": {
      "type": "string",
      "minLength": 1,
      "description": "Type of entity that owns the contact (e.g., merchant, branch, warehouse)"
    },
    "owner_id": {
      "type": "string",
      "format": "uuid",
      "description": "Identifier of the owning entity"
    },
    "name": { "type": ["string", "null"], "maxLength": 255 },
    "email": {
      "type": ["string", "null"],
      "format": "email",
      "maxLength": 255
    },
    "role": {
      "type": ["string", "null"],
      "maxLength": 128,
      "description": "Role or job title of the contact"
    },
    "is_primary": { "type": "boolean", "default": false },
    "status": {
      "type": "string",
      "enum": ["active", "inactive"],
      "default": "active"
    },
    "created_at": { "type": "string", "format": "date-time", "readOnly": true },
    "updated_at": { "type": "string", "format": "date-time", "readOnly": true },
    "deleted_at": { "type": ["string", "null"], "format": "date-time", "readOnly": true }
  },

  "required": ["owner_type", "owner_id", "status"],

  "x-pg": {
    "table": "contacts",
    "primaryKey": ["id"],
    "indexes": [
      { "name": "idx_contacts_owner", "columns": ["owner_type", "owner_id"] },
      { "name": "idx_contacts_status", "columns": ["status"] },
      { "name": "idx_contacts_is_primary", "columns": ["is_primary"] },
      { "name": "idx_contacts_email", "expression": "lower(email)" }
    ],
    "triggers": [
      { "name": "trg_contacts_set_updated_at", "timing": "BEFORE", "event": "UPDATE", "function": "set_updated_at()" }
    ]
  }
}
